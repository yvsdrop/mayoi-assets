<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XK2V3DH3WC"></script>
  <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-XK2V3DH3WC');</script>
  <style>
    .nav-icons {display:flex;align-items:center;position:absolute;top:1em;right:1em}
    .nav-icons img {height:24px}
    .entries-grid {display:grid;grid-gap:1em;grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));margin: 1em auto 3em;text-align:left}
    .entry-link {display:flex;align-items:center;font-size:14px}
    .entry-link img {width:60px}
    .btn-group img {height:24px}
    .filter-group-global .active * {filter:brightness(0) invert(1)}
    #sortDir:hover {filter:brightness(1.5)}
    h2, h3 {text-align:center}
  </style>
  <title>Bungo Stray Dogs: Tales of the Lost - Battle Sprites</title>
  <meta name="description" content="Battle Sprites animations viewer for the Bungo Stray Dogs mobile game.">
</head>
<body>
  <div id="main" class="container" style="margin-top:4em">
    <h2>Bungo Mayoi Battle Sprites</h2>
    <div style="display:flex;flex-wrap:wrap;margin:2em 0">
      <div id="filters">
        <div class="btn-group filter-group-rarity">
          <button class="btn btn-outline-dark" title="R" data-value="4-1">
            <img alt="R" src="https://static.wikia.nocookie.net/bsdmayoi/images/f/f7/R.png">
          </button>
          <button class="btn btn-outline-dark" title="SR" data-value="6-1">
            <img alt="SR" src="https://static.wikia.nocookie.net/bsdmayoi/images/3/3b/SR.png">
          </button>
          <button class="btn btn-outline-dark" title="SSR" data-value="8-1">
            <img alt="SSR" src="https://static.wikia.nocookie.net/bsdmayoi/images/0/06/SSR.png">
          </button>
          <button class="btn btn-outline-dark" title="EX" data-value="8-2">
            <img alt="EX" src="https://static.wikia.nocookie.net/bsdmayoi/images/8/80/EX.png">
          </button>
          <button class="btn btn-outline-dark" title="UR" data-value="10-1">
            <img alt="UR" src="https://static.wikia.nocookie.net/bsdmayoi/images/5/53/UR.png">
          </button>
        </div>
        <div class="btn-group filter-group-affinity">
          <button class="btn btn-outline-dark" title="Crimson" data-value="1">
            <img alt="Crimson" src="https://static.wikia.nocookie.net/bsdmayoi/images/7/77/Attribute_Crimson.png">
          </button>
          <button class="btn btn-outline-dark" title="Azure" data-value="2">
            <img alt="Azure" src="https://static.wikia.nocookie.net/bsdmayoi/images/6/67/Attribute_Azure.png">
          </button>
          <button class="btn btn-outline-dark" title="Emerald" data-value="3">
            <img alt="Emerald" src="https://static.wikia.nocookie.net/bsdmayoi/images/3/33/Attribute_Emerald.png">
          </button>
          <button class="btn btn-outline-dark" title="Light" data-value="4">
            <img alt="Light" src="https://static.wikia.nocookie.net/bsdmayoi/images/5/50/Attribute_Light.png">
          </button>
          <button class="btn btn-outline-dark" title="Dark" data-value="5">
            <img alt="Dark" src="https://static.wikia.nocookie.net/bsdmayoi/images/1/1a/Attribute_Dark.png">
          </button>
        </div>
        <div class="btn-group filter-group-global">
          <button class="btn btn-outline-dark" title="Global" data-value="1">
            <img alt="Global" src="https://fonts.gstatic.com/s/i/googlematerialicons/public/v6/gm_grey-48dp/2x/gm_public_gm_grey_48dp.png">
          </button>
          <button class="btn btn-outline-dark" title="Japan" data-value="2">
            <svg xmlns="http://www.w3.org/2000/svg" width="22.249" height="22.25" fill="#5f6368"><path d="M15.812 4.962c1.237.686 2.063.064 3.235-.388 1.427-.553 1.946-1.704 3.201-2.54-3.033.413-3.038.417-5.441-1.534-.26-.212-.488-.377-.805-.257-.398.15-.236.491-.212.778.083.98.037 2.193-.83 2.554-1.602.664-1.62 1.67-1.257 3.052.439-.275 1.174-.685 1.152-.728-.656-1.349.844-1.001.957-.937zM.333 19.694c.923-.147.677.282.615.766-.076.582-.328 1.356.432 1.562.688.185.746-.675 1.066-1.082.123-.157.189-.359.302-.523.341-.492.392-1 1.428-.869 1.734.22 2.762-1.267 2.3-2.763.352.032.663.019.751.535.208 1.211.781 1.466 1.583.604.912-.98 2.153-.743 3.184-1.188 1.084-.469 2.691-.265 2.63-2.361-.028-.917.004-2.463.616-2.949 1.403-1.11.977-2.167.517-3.353-.179-.464.124-1.468-.879-1.191-.817.228-1.758.686-1.562 1.772.285 1.584-.653 2.643-1.429 3.761-.299.434-1.101.965-1.406.721-1.221-.973-1.125.12-1.514.731-.344.538-.369 1.473-1.418 1.388-2.177-.174-4.065.588-5.749 1.919-.311.246-.133.556-.069.847-.583.072-1.036.4-1.451.778-.361.326-.404.967.053.895z"/></svg>
          </button>
        </div>
      </div>
      <div style="margin-left:auto">
        Sort by:
        <select class="custom-select" id="sortSelect" style="width:auto">
          <option value="id_jp">Release Date (JP)</option>
          <option value="id_en">Release Date (EN)</option>
          <option value="char">Character</option>
          <option value="title">Title</option>
        </select>
        <img id="sortDir" style="height:28px;margin-left:4px;cursor:pointer;transform:scaleY(-1);"
            src="https://fonts.gstatic.com/s/i/googlematerialicons/swap_vert/v6/gm_grey-48dp/2x/gm_swap_vert_gm_grey_48dp.png">
      </div>
    </div>
    <div id="chara-entries" class="entries-grid"></div>
    <h3>Enemies / Other Units</h3>
    <div id="other-entries" class="entries-grid"></div>
  </div>
  <div class="nav-icons">
    <select class="custom-select" id="localeSelect" style="margin-right:1em">
      <option value="en">English</option>
      <option value="jp">日本語</option>
    </select>
    <a href="https://github.com/yvsdrop/mayoi-assets"><img src="https://fonts.gstatic.com/s/i/googlematerialicons/info/v9/gm_grey-48dp/2x/gm_info_gm_grey_48dp.png"></a>
  </div>
  <script>
    const comparators = {
      'id_en': (locale) => (a, b) => a['codex_id']['en'] - b['codex_id']['en'],
      'id_jp': (locale) => (a, b) => a['codex_id']['jp'] - b['codex_id']['jp'],
      'char': (locale) => (a, b) => a['name'][locale].localeCompare(b['name'][locale]),
      'title': (locale) => (a, b) => a['title'][locale].localeCompare(b['title'][locale]),
    };
    let main_data;
    loadMain();

    $('#localeSelect').change(function() {
      renderAllCharacters();
    });
    $('#sortSelect').change(function() {
      renderAllCharacters();
    });
    $('#sortDir').click(function() {
      if ($(this).css('transform') == 'matrix(1, 0, 0, 1, 0, 0)') {
        $(this).css('transform', 'scaleY(-1)');
      } else {
        $(this).css('transform', 'scaleY(1)');
      }
      renderAllCharacters();
    });
    $('#filters .btn').click(function() {
      $(this).toggleClass('active');
      filterCharacters();
    });

    function loadMain() {
      fetch('index.json')
        .then(response => response.json())
        .then(json => {
          main_data = json;
          renderAllCharacters();
        });
    }
    function renderAllCharacters() {
      const charaEntries = [];
      const otherEntries = [];
      const locale = $('#localeSelect').val();
      const sortType = $('#sortSelect').val();
      const sortDir = $('#sortDir').css('transform') == 'matrix(1, 0, 0, 1, 0, 0)' ? 1 : -1;
      main_data['characters'].sort((a, b) => {
        return sortDir * comparators[sortType](locale)(a, b);
      });

      for (const item of main_data['characters']) {
        if (item['release_time'] > Math.floor(Date.now() / 1000)) {
          continue;
        }
        const title = item['title'][locale] ? `[${item['title'][locale]}] ` : '';
        const global = item['codex_id']['en'] > 0 ? '1' : '2';
        let label = title + item['name'][locale];
        if (item['extra']) {
          label += ' (EX)'
        }
        charaEntries.push(`<a class="entry-link" data-rarity="${item['rarity']}-${item['extra_type']}" data-affinity="${item['affinity']}" data-global="${global}" href="./spriteviewer.html?id=${item['mini_id']}"><img src="thumbnails/${item['img_id']}.png">${label}</a>`);
      }
      for (const item of main_data['other']) {
        const label = item['name'][locale];
        const mini_id = item['mini_id'];
        otherEntries.push(`<a class="entry-link" href="./spriteviewer.html?id=${mini_id}">${label}</a>`);
      }
      document.getElementById('chara-entries').innerHTML = charaEntries.join('');
      document.getElementById('other-entries').innerHTML = otherEntries.join('');
      filterCharacters();
    }
    function filterCharacters() {
      const charaEntries = $('#chara-entries .entry-link');
      charaEntries.each(function() {
        this.style.display = 'none';
      });
      let filteredList = charaEntries;
      const filterKeys = ['rarity', 'affinity', 'global'];
      for (const key of filterKeys) {
        const activeFilters = $('.filter-group-' + key + ' > .active').toArray();
        filteredList = filterCharactersByKey(filteredList, key, activeFilters);
      }
      filteredList.each(function() {
        this.style.display = '';
      });
    }
    function filterCharactersByKey(list, key, filter) {
      // If no active filters, all elements valid.
      if (!filter.length) {
        return list;
      }
      return list.filter((i, entry) => {
        return filter.find((filterEntry) => {
          return String(filterEntry.dataset.value).toLowerCase() ===
              String(entry.dataset[key]).toLowerCase();
        });
      });
    }
  </script>
</body>
</html>